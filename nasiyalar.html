<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nasiyalar – Grand Smart Shop</title>
  <style>
    /* ... (styles as in previous version) ... */
  </style>
</head>
<body role="main">

  <nav><a href="index.html">◀ Bosh sahifa</a></nav>
  <h1>Nasiyalar</h1>
  <div id="totalSum">Nasiyalar: yuklanmoqda...</div>
  <div id="errorMsg" style="color:#b00; text-align:center; display:none"></div>
  <div id="loading" style="text-align:center; display:none">Yuklanmoqda...</div>

  <div style="text-align:center; margin:1rem 0;">
    <button id="addNasiyaBtn">➕ Nasiya qo‘shish</button>
  </div>

  <div id="nasiyaList"></div>

  <!-- Modal -->
  <div id="nasiyaModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
    <div style="background:#fff; padding:1rem; border-radius:8px; width:90%; max-width:400px;">
      <h2>Nasiya qo‘shish</h2>
      <form id="nasiyaForm">
        <!-- form fields: ism, oldi, berdi, foiz, izoh -->
        <!-- as per previous version with min=0 validation -->
      </form>
      <button id="closeModalBtn">Bekor qilish</button>
    </div>
  </div>

  <script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxMgC8ce1FbV0UjXU6TSlNcRTYyfq3MzQsvqSfGFt-USbn6LeuAWEAHWpmeV3TQgsvrWA/exec";
  function showLoading(show) { document.getElementById('loading').style.display = show ? '' : 'none'; }
  function showError(msg) { const e = document.getElementById('errorMsg'); e.textContent = msg; e.style.display = msg? 'block':'none'; }

  function parseDate(s) { /* parse dd.MM.yyyy HH:mm */ }
  function formatSum(n) { return n.toLocaleString('uz-UZ') + " so'm"; }

  async function loadNasiyalar() {
    showLoading(true); showError('');
    try {
      const res = await fetch(API_URL);
      const data = await res.json();
      // group by ism, parse summa, sort by date
      // then render and pager
    } catch (err) {
      showError('Yuklashda xato');
    } finally {
      showLoading(false);
    }
  }

  // renderNasiyaList, renderPager, modal/form logic, fetch POST with headers, try/finally to re-enable button
  
  window.addEventListener('DOMContentLoaded', loadNasiyalar);
  </script>
</body>
</html>
